.. default-domain:: chpl

.. module:: SegmentedArray

SegmentedArray
==============
**Usage**

.. code-block:: chapel

   use SegmentedArray;


or

.. code-block:: chapel

   import SegmentedArray;

.. data:: param SegmentedArrayUseHash = useHash

.. class:: OutOfBoundsError : Error

.. class:: SegString

   Represents an array of strings, implemented as a segmented array of bytes.
   Instances are ephemeral, not stored in the symbol table. Instead, attributes
   of this class refer to symbol table entries that persist. This class is a
   convenience for bundling those persistent objects and defining string-relevant
   operations.
   


   .. attribute:: var offsetName: string

   .. attribute:: var offsets: borrowed SymEntry(int)

   .. attribute:: var valueName: string

   .. attribute:: var values: borrowed SymEntry(uint(8))

   .. attribute:: var size: int

   .. attribute:: var nBytes: int

   .. method:: proc init(segName: string, valName: string, st: borrowed SymTab)

      This initializer is the most common, and is used when only the server
      names of the SymEntries are known. It handles the lookup. 

   .. method:: proc init(segments: [] int, values: [] uint(8), st: borrowed SymTab)

   .. method:: proc show(n: int = 3) throws

   .. method:: proc this(idx: int): string throws

      Retrieve one string from the array 

   .. method:: proc this(const slice: range(stridable = true)) throws

      Take a slice of strings from the array. The slice must be a 
      Chapel range, i.e. low..high by stride, not a Python slice.
      Returns arrays for the segment offsets and bytes of the slice.

   .. method:: proc this(iv: [?D] int) throws

      Gather strings by index. Returns arrays for the segment offsets
      and bytes of the gathered strings.

   .. method:: proc this(iv: [?D] bool) throws

      Logical indexing (compress) of strings. 

   .. method:: proc hash() throws

      Apply a hash function to all strings. This is useful for grouping
      and set membership. The hash used is SipHash128.

   .. method:: proc argGroup() throws

      Return a permutation that groups the strings. Because hashing is used,
      this permutation will not sort the strings, but all equivalent strings
      will fall in one contiguous block. 

   .. method:: proc getLengths()

      Return lengths of all strings, including null terminator. 

   .. method:: proc findSubstringInBytes(const substr: string)

   .. method:: proc substringSearch(const substr: string, mode: SearchMode) throws

   .. method:: proc peel(const delimiter: string, const times: int, param includeDelimiter: bool, param keepPartial: bool, param left: bool)

   .. method:: proc stick(other: SegString, delim: string, param right: bool) throws

   .. method:: proc ediff(): [offsets.aD] int

   .. method:: proc isSorted(): bool

   .. method:: proc argsort(checkSorted: bool = true): [offsets.aD] int throws

.. function:: proc memcmp(const ref x: [] uint(8), const xinds, const ref y: [] uint(8), const yinds): int

.. enum:: enum SearchMode { contains, startsWith, endsWith }

.. class:: UnknownSearchMode : Error

.. function:: proc ==(lss: SegString, rss: SegString) throws

   Test for equality between two same-length arrays of strings. Returns
   a boolean vector of the same length. 

.. function:: proc !=(lss: SegString, rss: SegString) throws

   Test for inequality between two same-length arrays of strings. Returns
   a boolean vector of the same length. 

.. function:: proc ==(ss: SegString, testStr: string)

   Test an array of strings for equality against a constant string. Return a boolean
   vector the same size as the array. 

.. function:: proc !=(ss: SegString, testStr: string)

   Test an array of strings for inequality against a constant string. Return a boolean
   vector the same size as the array. 

.. function:: proc compare(ss: SegString, testStr: string, param polarity: bool)

   Element-wise comparison of an arrays of string against a target string. 
   The polarity parameter determines whether the comparison checks for 
   equality (polarity=true, result is true where elements equal target) 
   or inequality (polarity=false, result is true where elements differ from 
   target). 

.. function:: proc in1d(mainStr: SegString, testStr: SegString, invert = false) throws

   Test array of strings for membership in another array (set) of strings. Returns
   a boolean vector the same size as the first array. 

.. function:: proc concat(s1: [] int, v1: [] uint(8), s2: [] int, v2: [] uint(8)) throws

.. function:: proc in1d(mainStr: SegString, testStr: SegString, invert = false) throws

.. function:: proc interpretAsString(bytearray: [?D] uint(8)): string

   Convert an array of raw bytes into a Chapel string. 

